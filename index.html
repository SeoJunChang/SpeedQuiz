<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
	<title>êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ í€´ì¦ˆ</title>
	<style>
		*{margin:0;padding:0;box-sizing:border-box}
		:root{--bg:#0f172a;--bg2:#1e293b;--bg3:#334155;--accent:#3b82f6;--gold:#fbbf24;--error:#ef4444;--success:#22c55e}
		body{font-family:'Apple SD Gothic Neo',sans-serif;background:var(--bg);color:#fff;height:100vh;display:flex;justify-content:center}
		.app{width:100%;max-width:500px;display:flex;flex-direction:column;padding:20px}
		header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
		.cat-badge{display:inline-block;padding:4px 10px;background:var(--accent);border-radius:20px;font-size:12px;margin-bottom:10px}
		.progress-container{width:100%;height:6px;background:#334155;border-radius:3px;overflow:hidden;margin-bottom:20px}
		.timer-bar{width:100%;height:100%;background:linear-gradient(to right, #3b82f6, #fbbf24);transition:width 0.1s linear}
		.game-card{background:var(--bg2);border-radius:20px;padding:30px;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative}
		.question{font-size:24px;font-weight:bold;margin-bottom:30px;line-height:1.4}
		.answer-input{width:100%;background:var(--bg3);border:2px solid transparent;padding:15px;border-radius:12px;color:#fff;font-size:24px;text-align:center;outline:none}
		.answer-input:focus{border-color:var(--accent)}
		.result-overlay{position:fixed;inset:0;background:var(--bg);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:100;padding:20px}
		.result-overlay.on{display:flex}
		.btn{padding:15px;border:none;border-radius:15px;background:var(--accent);color:#fff;font-weight:bold;font-size:16px;cursor:pointer;width:100%}
		.cat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;margin-top:20px}
		.loading{font-size:18px;color:var(--gold)}
	</style>
</head>
<body>
	<div class="app">
		<header>
			<div id="status">ë°ì´í„° ë¡œë”© ì¤‘...</div>
			<div>ì ìˆ˜: <span id="score">0</span></div>
		</header>
		<div class="progress-container"><div id="timerBar" class="timer-bar" style="width:0%"></div></div>

		<div id="startScreen" class="game-card">
			<h2 id="welcomeMsg">í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</h2>
			<div id="categoryButtons" class="cat-grid"></div>
		</div>

		<div id="gameScreen" class="game-card" style="display:none">
			<div id="catBadge" class="cat-badge">ì¹´í…Œê³ ë¦¬</div>
			<div id="question" class="question"></div>
			<input type="text" id="answerInput" class="answer-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off">
			<div id="hint" style="margin-top:20px; font-size:14px; color:var(--gold)"></div>
		</div>
	</div>

	<div id="resultOverlay" class="result-overlay">
		<h1>í€´ì¦ˆ ì¢…ë£Œ!</h1>
		<div id="resultMsg"></div>
		<button class="btn" style="width:200px; margin-top:20px" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
	</div>

	<script>
		// êµ¬ê¸€ ì‹œíŠ¸ ê²Œì‹œíŒ ID (ì‚¬ìš©ìë‹˜ ì‹œíŠ¸ ê¸°ë°˜)
		const SHEET_ID = '1vQwOeULvb3hcqNCTNHmUEU7bqeDPvoPs96ue-e6yAmb1t80o9SvX4bO-JK6Rw-il9vYhdKBtdvf4z5B';
		const SHEET_URL = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?output=csv`;

		let allData = [];
		let gameItems = [];
		let curIdx = 0, score = 0, correctCount = 0, totalTime = 0;
		let timeLeft = 100, timerInterval = null, isProcessing = false;
		const TIME_LIMIT = 10;

		const qText = document.getElementById('question');
		const aInput = document.getElementById('answerInput');
		const tBar = document.getElementById('timerBar');
		const hText = document.getElementById('hint');
		const cBadge = document.getElementById('catBadge');

		async function loadData() {
			try {
				const response = await fetch(SHEET_URL);
				const csvText = await response.text();

				// CSV íŒŒì‹±
				const rows = csvText.split('\r\n').map(row => row.split(','));
				const headers = rows[0]; // word, clue, direct, cat, level

				allData = rows.slice(1).map(row => ({
					word: row[0]?.trim(),
					clue: row[1]?.trim(),
					direct: row[2]?.trim(),
					cat: row[3]?.trim(),
					level: row[4]?.trim()
				})).filter(item => item.word); // ë¹ˆ ì¤„ ë°©ì§€

				const categories = [...new Set(allData.map(d => d.cat))];
				renderButtons(categories);
				document.getElementById('welcomeMsg').textContent = "ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”";
				document.getElementById('status').textContent = "ì¤€ë¹„ ì™„ë£Œ";
			} catch (e) {
				document.getElementById('welcomeMsg').textContent = "ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨!";
				console.error(e);
			}
		}

		function renderButtons(categories) {
			const container = document.getElementById('categoryButtons');
			container.innerHTML = '';
			categories.forEach(cat => {
				const btn = document.createElement('button');
				btn.className = 'btn';
				btn.textContent = cat;
				btn.onclick = () => startGame(cat);
				container.appendChild(btn);
			});
		}

		function startGame(cat) {
			const filtered = allData.filter(d => d.cat === cat);
			gameItems = filtered.sort(() => Math.random() - 0.5).slice(0, 12);

			document.getElementById('startScreen').style.display = 'none';
			document.getElementById('gameScreen').style.display = 'flex';
			startQuest();
		}

		function startQuest() {
			if(curIdx >= gameItems.length) return endGame();
			isProcessing = false;
			const item = gameItems[curIdx];

			cBadge.textContent = item.cat;
			qText.textContent = item.clue;
			hText.textContent = `ğŸ’¡ íŒíŠ¸: ${item.direct}`;
			document.getElementById('status').textContent = `${curIdx + 1} / ${gameItems.length}`;

			// [í•´ê²°í¬ì¸íŠ¸ 1] ì…ë ¥ì°½ ì´ˆê¸°í™” ë° í¬ì»¤ìŠ¤ ë¦¬ì…‹
			aInput.blur(); // í˜„ì¬ í¬ì»¤ìŠ¤ í•´ì œ (ì¡°í•© ì¤‘ì¸ í•œê¸€ ê°•ì œ ì¢…ë£Œ)
			aInput.value = '';

			setTimeout(() => {
				aInput.focus(); // 0.1ì´ˆ ë’¤ ë‹¤ì‹œ í¬ì»¤ìŠ¤ (ì”ìƒ ë°©ì§€)
			}, 100);

			aInput.style.borderColor = "transparent";
			startTimer();
		}

		aInput.addEventListener('input', () => {
			if(!isProcessing && aInput.value.trim() === gameItems[curIdx].word) processCorrect();
		});

		function startTimer() {
			timeLeft = 100;
			if(timerInterval) clearInterval(timerInterval);
			timerInterval = setInterval(() => {
				timeLeft -= 1;
				tBar.style.width = timeLeft + "%";
				if(timeLeft <= 0) processWrong();
			}, 100);
		}

		function processCorrect() {
			if(isProcessing) return;
			isProcessing = true;
			clearInterval(timerInterval);

			// [í•´ê²°í¬ì¸íŠ¸ 2] ì •ë‹µ ì²˜ë¦¬ ì¦‰ì‹œ ì…ë ¥ì°½ ë¹„ìš°ê¸°
			aInput.style.borderColor = "var(--success)";

			// ì ìˆ˜ ë° í†µê³„ ê³„ì‚°
			correctCount++;
			score += Math.max(10, Math.ceil(timeLeft));
			document.getElementById('score').textContent = score;

			// ì ì‹œ í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
			setTimeout(() => {
				curIdx++;
				aInput.value = ''; // ì´ë™ ì§ì „ í•œ ë²ˆ ë” ë¹„ìš°ê¸°
				startQuest();
			}, 500);
		}

		function processWrong() {
			isProcessing = true;
			clearInterval(timerInterval);
			aInput.style.borderColor = "var(--error)";
			qText.innerHTML = `<span style="color:var(--error)">ì‹œê°„ ì´ˆê³¼!</span><br>ì •ë‹µ: ${gameItems[curIdx].word}`;
			setTimeout(() => { curIdx++; startQuest(); }, 1500);
		}

		function endGame() {
			document.getElementById('resultOverlay').classList.add('on');
			document.getElementById('resultMsg').innerHTML = `<h2>${score}ì </h2><p>${correctCount}ë¬¸ì œ ì •ë‹µ!</p>`;
		}

		window.onload = loadData;
	</script>
</body>
</html>
