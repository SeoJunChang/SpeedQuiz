<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ì´ˆìŠ¤í”¼ë“œ í•œê¸€ í€´ì¦ˆ</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#0f172a;--bg2:#1e293b;--bg3:#334155;--accent:#3b82f6;--gold:#fbbf24;--error:#ef4444;--success:#22c55e}
        body{font-family:'Apple SD Gothic Neo',sans-serif;background:var(--bg);color:#fff;height:100vh;display:flex;justify-content:center}
        .app{width:100%;max-width:500px;display:flex;flex-direction:column;padding:20px}
        header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
        .cat-badge{display:inline-block;padding:4px 10px;background:var(--accent);border-radius:20px;font-size:12px;margin-bottom:10px}
        .progress-container{width:100%;height:6px;background:#334155;border-radius:3px;overflow:hidden;margin-bottom:20px}
        .timer-bar{width:100%;height:100%;background:linear-gradient(to right, #3b82f6, #fbbf24);transition:width 0.1s linear}
        .game-card{background:var(--bg2);border-radius:20px;padding:30px;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;box-shadow:0 10px 25px rgba(0,0,0,0.3)}
        .question{font-size:22px;font-weight:bold;margin-bottom:30px;line-height:1.4;word-break:keep-all}
        .answer-input{width:100%;background:var(--bg3);border:2px solid transparent;padding:15px;border-radius:12px;color:#fff;font-size:24px;text-align:center;outline:none;transition:border-color 0.2s}
        .answer-input:focus{border-color:var(--accent)}
        .result-overlay{position:fixed;inset:0;background:var(--bg);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:100;padding:20px}
        .result-overlay.on{display:flex}
        .btn{padding:15px;border:none;border-radius:15px;background:var(--accent);color:#fff;font-weight:bold;font-size:16px;cursor:pointer;width:100%;margin-top:10px}
        /* ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ë“¤ì„ ë‹´ëŠ” ê·¸ë¦¬ë“œ ì„¤ì • ìˆ˜ì • */
.cat-grid {
    display: grid;
    /* í™”ë©´ ë„ˆë¹„ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì—´ ê°œìˆ˜ ì¡°ì • (ìµœì†Œ 140px ë„ˆë¹„) */
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
    gap: 10px;
    width: 100%;
    margin-top: 20px;
    /* ë‚´ìš©ì´ ë§ì•„ì§€ë©´ ìŠ¤í¬ë¡¤ë°” ìƒì„± */
    max-height: 50vh; 
    overflow-y: auto;
    padding: 5px;
}

/* ë²„íŠ¼ ë””ìì¸ ì‚´ì§ ì¡°ì • (ê°€ë…ì„± í–¥ìƒ) */
.cat-grid .btn {
    margin-top: 0; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²©ì€ gapìœ¼ë¡œ ì¡°ì ˆ */
    padding: 12px 10px;
    font-size: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 54px; /* ëª¨ë°”ì¼ í„°ì¹˜ í¸ì˜ì„± */
}

/* ê¹”ë”í•œ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
.cat-grid::-webkit-scrollbar {
    width: 6px;
}
.cat-grid::-webkit-scrollbar-thumb {
    background: var(--bg3);
    border-radius: 10px;
}
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div id="status">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <div>ì ìˆ˜: <span id="score">0</span></div>
        </header>
        <div class="progress-container"><div id="timerBar" class="timer-bar" style="width:0%"></div></div>
        
        <div id="startScreen" class="game-card">
            <h2 id="welcomeMsg">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</h2>
            <div id="categoryButtons" class="cat-grid"></div>
        </div>

        <div id="gameScreen" class="game-card" style="display:none">
            <div id="catBadge" class="cat-badge">ì¹´í…Œê³ ë¦¬</div>
            <div id="question" class="question"></div>
            <input type="text" id="answerInput" class="answer-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off">
            <div id="hint" style="margin-top:20px; font-size:14px; color:var(--gold)"></div>
        </div>
    </div>

    <div id="resultOverlay" class="result-overlay">
        <h1>í€´ì¦ˆ ì¢…ë£Œ!</h1>
        <div id="resultMsg"></div>
        <button class="btn" style="width:200px" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <script>
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/e/2PACX-1vQwOeULvb3hcqNCTNHmUEU7bqeDPvoPs96ue-e6yAmb1t80o9SvX4bO-JK6Rw-il9vYhdKBtdvf4z5B/pub?output=csv`;

        let allData = [];
        let gameItems = [];
        let curIdx = 0, score = 0, correctCount = 0, totalTime = 0;
        let timeLeft = 100, timerInterval = null, isProcessing = false;
        const TIME_LIMIT = 10;

        const qText = document.getElementById('question');
        const aInput = document.getElementById('answerInput');
        const tBar = document.getElementById('timerBar');
        const hText = document.getElementById('hint');
        const cBadge = document.getElementById('catBadge');
        const sNum = document.getElementById('score');

        async function loadData() {
            try {
                const response = await fetch(`${SHEET_URL}&t=${new Date().getTime()}`);
                const csvText = await response.text();
                
                // ë” ì•ˆì •ì ì¸ CSV íŒŒì‹± (ì¤„ë°”ê¿ˆ ê¸°í˜¸ í†µí•© ì²˜ë¦¬)
                const rows = csvText.split(/\r?\n/).map(row => row.split(','));
                
                allData = rows.slice(1).map(row => {
                    const clean = (val) => val ? val.replace(/^"|"$/g, '').trim() : '';
                    return {
                        word: clean(row[0]),
                        clue: clean(row[1]),
                        direct: clean(row[2]),
                        cat: clean(row[3]),
                        level: parseInt(clean(row[4])) || 1
                    };
                }).filter(item => item.word && item.cat); // ë‹¨ì–´ì™€ ì¹´í…Œê³ ë¦¬ê°€ ëª¨ë‘ ìˆëŠ” ê²ƒë§Œ

                const categories = [...new Set(allData.map(d => d.cat))];
                
                if(categories.length === 0) throw new Error("ì¹´í…Œê³ ë¦¬ ì—†ìŒ");
                
                renderButtons(categories);
                document.getElementById('welcomeMsg').textContent = "ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”";
                document.getElementById('status').textContent = "ì¤€ë¹„ ì™„ë£Œ";
            } catch (e) {
                document.getElementById('welcomeMsg').textContent = "ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
                console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", e);
            }
        }

        function renderButtons(categories) {
            const container = document.getElementById('categoryButtons');
            container.innerHTML = '';
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.textContent = cat;
                btn.onclick = () => startGame(cat);
                container.appendChild(btn);
            });
        }

        function startGame(cat) {
            const filtered = allData.filter(d => d.cat === cat);
            gameItems = filtered.sort(() => Math.random() - 0.5).slice(0, 12);
            
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'flex';
            startQuest();
        }

        function startQuest() {
            if(curIdx >= gameItems.length) return endGame();
            isProcessing = false;
            const item = gameItems[curIdx];

            cBadge.textContent = item.cat;
            qText.textContent = item.clue;
            hText.textContent = `ğŸ’¡ íŒíŠ¸: ${item.direct || 'íŒíŠ¸ ì—†ìŒ'}`;
            document.getElementById('status').textContent = `${curIdx + 1} / ${gameItems.length}`;
            
            // [ì”ìƒ í•´ê²°] í¬ì»¤ìŠ¤ ë¦¬ì…‹ ë¡œì§
            aInput.blur();
            aInput.value = '';
            aInput.style.borderColor = "transparent";
            
            setTimeout(() => {
                aInput.value = ''; // í¬ì»¤ìŠ¤ ì§ì „ í•œ ë²ˆ ë” ë¹„ìš°ê¸°
                aInput.focus();
            }, 150); // ì‹œê°„ì„ ì¡°ê¸ˆ ë” ëŠ˜ë ¤ ì•ˆì •ì„± í™•ë³´

            startTimer();
        }

        aInput.addEventListener('input', () => {
            if(isProcessing) return;
            if(aInput.value.trim() === gameItems[curIdx].word) {
                processCorrect();
            }
        });

        // ì—”í„°í‚¤ ì…ë ¥ ì‹œì—ë„ ì²˜ë¦¬
        aInput.addEventListener('keydown', (e) => {
            if(e.key === 'Enter' && !isProcessing) {
                e.preventDefault();
                if(aInput.value.trim() === gameItems[curIdx].word) processCorrect();
                else {
                    aInput.style.borderColor = "var(--error)";
                    setTimeout(() => aInput.style.borderColor = "transparent", 500);
                }
            }
        });

        function startTimer() {
            timeLeft = 100;
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 1;
                tBar.style.width = timeLeft + "%";
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    processWrong();
                }
            }, 100);
        }

        function processCorrect() {
            if(isProcessing) return;
            isProcessing = true;
            clearInterval(timerInterval);

            correctCount++;
            totalTime += (TIME_LIMIT - (timeLeft / 10));
            score += Math.max(10, Math.ceil(timeLeft));
            sNum.textContent = score;

            aInput.style.borderColor = "var(--success)";

            setTimeout(() => {
                curIdx++;
                aInput.value = ''; // ë‹¤ìŒ ë¬¸ì œ ë„˜ì–´ê°€ê¸° ì „ ê°•ì œ ë¹„ìš°ê¸°
                startQuest();
            }, 500);
        }

        function processWrong() {
            if(isProcessing) return;
            isProcessing = true;
            clearInterval(timerInterval);
            totalTime += TIME_LIMIT;

            aInput.style.borderColor = "var(--error)";
            qText.innerHTML = `<span style="color:var(--error)">ì‹œê°„ ì´ˆê³¼!</span><br>ì •ë‹µ: <b>${gameItems[curIdx].word}</b>`;

            setTimeout(() => {
                curIdx++;
                aInput.value = '';
                startQuest();
            }, 1500);
        }

        function endGame() {
            const avgSpeed = (totalTime / gameItems.length).toFixed(2);
            document.getElementById('resultOverlay').classList.add('on');
            document.getElementById('resultMsg').innerHTML = `
                <div style="font-size:48px; font-weight:bold; color:var(--gold); margin:20px 0">${score}ì </div>
                <div style="text-align:left; background:rgba(255,255,255,0.1); padding:20px; border-radius:15px; line-height:2">
                    ğŸ¯ ë§ì¶˜ ê°œìˆ˜: <strong>${correctCount} / ${gameItems.length}</strong><br>
                    âš¡ í‰ê·  ì†ë„: <strong>${avgSpeed}ì´ˆ</strong>
                </div>`;
        }

        window.onload = loadData;
    </script>
</body>
</html>
